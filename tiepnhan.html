<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HIS - Tiếp nhận bệnh nhân (Wireframe)</title>
  <style>
    :root {
      --bg: #f6f7f9;
      --card: #fff;
      --line: #e5e7eb;
      --txt: #111827;
      --muted: #6b7280;
      --primary: #2563eb;
      --font-family: "Times New Roman";
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
    }

    body {
      margin: 0;
      font: 14px/1.45 var(--font-family);
      color: var(--txt);
      background: var(--bg);
    }

    header {
      position: sticky;
      top: 0;
      z-index: 5;
      background: var(--card);
      border-bottom: 1px solid var(--line);
    }

    .bar {
      margin: auto;
      display: flex;
      gap: 12px;
      align-items: center;
      padding: 10px 16px;
    }

    .bar .search {
      flex: 1;
      display: flex;
      gap: 8px;
    }

    input[type="text"],
    input[type="date"],
    input[type="time"],
    select,
    textarea {
      width: 100%;
      padding: 2px 4px;
      border: 1px solid var(--line);
      border-radius: 8px;
      background: #fff;
      outline: none;
      font-family: var(--font-family);
      border: none; border-bottom: 1px dashed #000; outline: none;
      margin-bottom: 10px;
    }

    textarea {
      min-height: 84px;
      resize: vertical;

    }

    .btn {
      appearance: none;
      border: 1px solid var(--line);
      background: #fff;
      padding: 10px 14px;
      border-radius: 10px;
      cursor: pointer;
      font-family: var(--font-family);
    }

    .btn.primary {
      background: var(--primary);
      color: #fff;
      border-color: var(--primary)
    }

    .btn.secondary {
      background: var(--secondary);
      color: #2d29f4;
      border-color: var(--secondary)
    }

    .btn.thirty {
      background: var(--thirty);
      color: #f14e02;
      border-color: var(--thirty)
    }

    .btn:active {
      transform: translateY(1px)
    }

    main {
      width:100%;
      margin: 16px auto;
      padding: 0 16px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px
    }

    @media (min-width: 1024px) {
      main {
        grid-template-columns: 1fr 1fr 1fr;
        align-items: start
      }
    }

    .card {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 12px;
      box-shadow: 0 1px 0 rgba(0, 0, 0, .02);
      font-family: var(--font-family);
    }

    .card h2 {
      margin: 0;
      padding: 12px 14px;
      border-bottom: 1px solid var(--line);
      font-size: 15px;
      letter-spacing: .2px
    }

    .card .content {
      padding: 14px
    }

    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px
    }

    .grid-3 {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px
    }

    .grid-4 {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr;
      gap: 12px
    }

    .grid-auto {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 2px;
      padding: 2px 3px;
    }

    .label {
      font-size: 12px;
      color: var(--muted)
    }

    .hr {
      height: 1px;
      background: var(--line);
      margin: 10px 0
    }

    .inline {
      display: flex;
      align-items: center;
      gap: 8px
    }

    .muted {
      color: var(--muted)
    }

    .toolbar {
      display: flex;
      gap: 8px;
      flex-wrap: wrap
    }

    .footer-actions {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
      margin-top: 12px
    }

    /* sticky left column labels on tall forms (desktop only) */
    @media (min-width: 1024px) {
      .tall {
        max-height: calc(100vh - 106px);
        overflow: auto
      }
    }


  .btn { padding:8px 12px; border:1px solid #e5e7eb; border-radius:8px; background:#fff; cursor:pointer; }
  .btn.primary { background:#2563eb; color:#fff; border-color:#2563eb; }
  .btn.danger { background:#ef4444; color:#fff; border-color:#ef4444; }
  .qty-input { width:70px; text-align:center; padding:6px 4px; }
  #billTable tbody tr:hover { background:#f9fafb; }


   /* Áp dụng chung cho tất cả section có class "card tall" */
  section.card.tall {
    height: 100%;                /* cố định chiều cao chung */
    display: flex;
    flex-direction: column;
    background: #fff;
    border-radius: 8px;
    border: 1px solid #e5e7eb;
    overflow: hidden;             /* tránh tràn */
  }

  /* Phần nội dung cuộn được */
  section.card.tall > .content {
    flex: 1;
    overflow-y: auto;
    padding: 12px;
  }

  /* Footer cố định ở cuối section */
  section.card.tall > .footer-actions {
    flex-shrink: 0;
    display: flex;
    justify-content: flex-end;
    gap: 8px;
    padding: 10px 12px;
    background: #fafafa;
    border-top: 1px solid #e5e7eb;
    position: sticky;
    bottom: 0;
  }

  /* Đảm bảo bảng cuộn nội bộ (nếu có nhiều dòng) */
  section.card.tall table tbody {
    display: block;
    max-height: 220px;
    overflow-y: auto;
  }

  section.card.tall table thead,
  section.card.tall table tfoot {
    display: table;
    width: 100%;
    table-layout: fixed;
  }

  section.card.tall table tbody tr {
    display: table;
    width: 100%;
    table-layout: fixed;
  }
  </style>
</head>

<body>
  <header>
    <div class="bar" style="display: flex; align-items: center; gap: 20px;">
      <a href="home.html" style="display: flex; align-items: center;">
        <div style="width: 40px; height: 40px; background-color: #4CAF50; border-radius: 4px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 18px;">
          HIS
        </div>
      </a>
      <div class="search">
        <input type="text" placeholder="Tìm BN / CCCD / Mã hồ sơ" aria-label="Tìm bệnh nhân" />
        <button class="btn">Tìm kiếm</button>
        <button class="btn">Danh sách tiếp đón</button>
      </div>
      <div class="toolbar">
        <select id="counter">
          <option value="">-- Chọn quầy --</option>
          <option value="1">Quầy 1 - Tiếp nhận BHYT</option>
          <option value="2">Quầy 2 - Tiếp nhận dịch vụ</option>
          <option value="3">Quầy 3 - Khám cấp cứu</option>
          <option value="4">Quầy 4 - Tái khám / hẹn lịch</option>
        </select>
      </div>
      <button class="btn">Gọi số</button>
    </div>
  </header>

  <main>
    <!-- PHẦN 1: Thông tin cá nhân -->
    <section class="card tall" id="sec-patient">
      <h2>1) Thông tin khách hàng <button class="btn" title="Quét CCCD" style="font-weight: bold;" onclick="openQRCodeScanPopup()">Quét CCCD</button></h2>
      <div class="content">
        <div class="grid-2">
          <div class="field"><label class="label">Họ và tên</label>
            <input type="text" id="fullName"
              placeholder="NGUYỄN VĂN A" />

              </div>
          <div class="field"><label class="label">Giới tính</label>
            <div class="inline">
              <label><input type="radio" name="gender" value="Nam"> Nam</label>
              <label><input type="radio" name="gender" value="Nữ"> Nữ</label>
              <label><input type="radio" name="gender" value="Khác"> Khác</label>
            </div>
          </div>
        </div>
        <div class="grid-3">
          <div class="field"><label class="label">Quốc tịch</label>
            <select>
              <option>Việt Nam</option>
              <option>Campuchia</option>
              <option>Lào</option>
            </select>
          </div>
          <div class="field"><label class="label">Dân tộc</label>
            <select>
              <option>Kinh</option>
              <option>Thái</option>
              <option>Mường</option>
            </select>
          </div>
          <div class="field"><label class="label">Nghề nghiệp</label>
            <select>
              <option>Nhân viên văn phòng</option>
              <option>Nhân viên y tế</option>
              <option>Công chức</option>
            </select>
          </div>
        </div>
        <div class="grid-3">
          <div class="field"><label class="label">Số điện thoại</label><input type="text" /></div>
          <div class="field">
            <label class="label">Ngày sinh</label>
            <input type="date" style="flex:1" />
          </div>
          <div class="field">
            <label class="label">Giờ sinh</label>
            <input type="time" style="flex:1" value="00:00" />
          </div>
        </div>



        
        <div class="hr"></div>
        <div class="grid-1">
          <div class="field"><label class="label">Nơi công tác</label><input type="text" /></div>
        </div>
        <div class="grid-3">
          <div class="field"><label class="label">CCCD</label><input type="text" placeholder="0792xxxxxxxx" /></div>
          <div class="field"><label class="label">Tỉnh/TP</label>
            <select>
              <option>Hà Nội</option>
              <option>Hồ Chí Minh</option>
              <option>Đồng Nai</option>
            </select>
          </div>
          <div class="field"><label class="label">Phường/Xã</label>
            <select>
              <option>Phường 1</option>
              <option>Phường 2</option>
              <option>Phường 3</option>
            </select>
          </div>
        </div>
        <div class="grid-2">
          <div class="field"><label class="label">Số nhà - Đường</label><input type="text" /></div>
          <div class="field"><label class="label">Thôn/ phố</label><input type="text" /></div>
        </div>
        <div class="hr"></div>
        <div class="grid-3">
          <div class="field"><label class="label">Ngưởi bảo lãnh/Liên hệ</label><input type="text" /></div>
          <div class="field"><label class="label">Quan hệ</label>
            <select>
              <option>Vợ/Chồng</option>
              <option>Cha/Mẹ</option>
              <option>Khác</option>
            </select>
          </div>
          <div class="field"><label class="label">SĐT liên hệ</label><input type="text" /></div>
      </div>
      <div class="grid-2">
        <div class="field"><label class="label">CCCD/Hộ Chiếu</label><input type="text" /></div>
        <div class="field"><label class="label">Địa chỉ</label><input type="text" /></div>
      </div>
        <div class="inline" style="gap:12px; flex-wrap:wrap">
          <button class="btn">Chọn tệp…</button>
        </div>
    </section>

    <!-- PHẦN 2: Đăng ký khám -->
    <section class="card tall" id="sec-visit">
      <h2>2) Hình thức khám chữa bệnh</h2>
      <div class="content">
        <div class="grid-1">
          <div class="field" ><label class="label">Loại Hình KCB</label>
            <select>
              <option>01 Khám bệnh.</option>
              <option>02 Điều trị ngoại trú.</option>
              <option>03 Điều trị nội trú.</option>
              <option>04 Điều trị nội trú ban ngày.</option>
              <option>05 Điều trị ngoại trú các bệnh mạn tính dài ngày liên tục trong năm, áp dụng cho các bệnh theo
                danh mục ban hành kèm theo Thông tư số 46/2016/TT-BYT ngày 30/12/2016 của Bộ trưởng Bộ Y tế về ban hành
                danh mục bệnh cần chữa trị dài ngày, có khám bệnh và lĩnh thuốc.</option>
            </select>
          </div>
          <div class="field"><label class="label">Lý do vào viện</label><input type="text"
              placeholder="Ví dụ: Khám lâm sàng tổng quát" /></div>
        </div>

        <div class="hr"></div>

        <div class="field" id="bhyt-field">
          <span class="label">Chọn hình thức khám</span>
          <div class="inline">
            <label class="inline"><input type="radio" name="bhyt_opt" value="bhyt" checked onchange="toggleBHYT(true)">
              Khám BHYT</label>
            <label class="inline"><input type="radio" name="bhyt_opt" value="kbhty" onchange="toggleBHYT(false)"> Khám dịch vụ</label>
          </div>
        </div>
        <div id="bhyt-block">
          <div class="grid-3">
            <div class="field"><label class="label">Mã thẻ BHYT</label><input type="text"
                placeholder="HC40101234" /></div>
            <div class="field"><label class="label">Mức hưởng</label><input type="text" /></div>
            <div class="field"><label class="label">Nơi ĐK KCB ban đầu</label><input type="text" /></div>
          </div>
          <div class="grid-1">
            <div class="field"><label class="label">Đối tượng KCB</label>
              <select>
                <option>1.1 Đến KCB đúng cơ sở KCB nơi đăng ký KCB BHYT ban đầu (Trừ trường hợp quy định tại mã 1.2)
                </option>
                <option>1.2 Đi KCB tại cơ sở KCB cấp ban đầu bao gồm trạm y tế, cơ sở KCB y học gia đình, trạm y tế quân
                  - dân y, trung tâm y tế huyện (trung tâm y tế khu vực từ 01/7/2025) được cấp giấy phép hoạt động theo
                  hình thức tổ chức là phòng khám, y tế cơ quan, đơn vị, tổ chức được tổ chức dưới hình thức trạm y tế
                  hoặc phòng khám, cơ sở KCB cấp ban đầu trong quân đội, công an (Bao gồm cả trường hợp đến đúng cơ sở
                  KCB nơi đăng ký KCB BHYT ban đầu và đi KCB không đúng nơi đăng ký KCB BHYT ban đầu)</option>
                <option>1.3 Đến KCB có phiếu chuyển cơ sở KCB (Bao gồm Phiếu chuyển cơ sở KCB có giá trị 1 năm)</option>
                <option>1.4 Trường hợp KCB khi thay đổi nơi lưu trú, nơi cư trú theo quy định tại Điều 4 Thông tư số
                  01/2025/TT- BYT</option>
                <option>1.5 Đến KCB theo phiếu hẹn khám lại theo quy định tại Điều 11 Thông tư số 01/2025/TT-BYT
                </option>
              </select>
            </div>
          </div>
          <div class="grid-3">
            <div class="field"><label class="label">Hạn từ</label><input type="date" /></div>
            <div class="field"><label class="label">Hạn đến</label><input type="date" /></div>
            <div class="field"><label class="label">Thời điểm đủ 5 năm</label><input type="date" /></div>
          </div>
        </div>


        <div class="hr"></div>


        <div class="field" id="ct-field">
          <span class="label">Thông tin Chuyển tuyến</span>
          <div class="inline">
            <label class="inline"><input type="radio" name="ct_opt" value="koct" checked
                onchange="toggleChuyenTuyen(false)"> Không chuyển tuyến</label>
            <label class="inline"><input type="radio" name="ct_opt" value="coct" onchange="toggleChuyenTuyen(true)">
              Chuyển tuyến</label>
          </div>
        </div>
        <div id="ct-block" style="display:none">
          <div class="grid-3">
            <div class="field"><label class="label">Nơi chuyển tuyến</label><input type="text" /></div>
            <div class="field"><label class="label">Chuẩn đoán</label><input type="text" /></div>
            <div class="field"><label class="label">Số giấy CT</label><input type="text" /></div>
          </div>
          <div class="grid-3">
            <div class="field"><label class="label">Điều trị từ</label><input type="date" /></div>
            <div class="field"><label class="label">Điều trị đến</label><input type="date" /></div>
            <div class="inlfieldine">
              <label class="label">Đính kèm hồ sơ</label>
              <button class="btn">Chọn tệp…</button>
            </div>
          </div>
        </div>
      </div>

      <div class="footer-actions">
        <button class="btn">Hủy</button>
        <button class="btn primary" onclick="saveForm()">Lưu thông tin KCB</button>
      </div>
    </section>
    
<!-- PHẦN 3: Đăng ký khám bệnh -->
<section class="card tall" id="sec-extra">
  <h2>3) Đăng ký khám chữa bệnh</h2>
  <div class="content">
    <div class="grid-1">
      <!-- PHẦN CHỌN DỊCH VỤ -->
      <div class="field">
        <label class="label">Tên dịch vụ</label>
        <div style="display:flex; gap:8px; align-items:center;">
          <select id="serviceName" style="min-width:280px; padding:6px 8px;">
            <option value="kham-tong-quat" data-price="150000">Khám tổng quát</option>
            <option value="kham-chuyen-khoa" data-price="200000">Khám mắt</option>
            <option value="xet-nghiem-mau" data-price="120000">Khám tai mũi họng</option>
            <option value="xquang" data-price="250000">Khám da liễu</option>
            <option value="sieu-am" data-price="180000">Khám cơ xương khớp</option>
          </select>
          <button id="btnAddService" class="btn primary" type="button">Thêm</button>
        </div>
      </div>

      <!-- BẢNG KÊ DỊCH VỤ -->
      <div class="card" style="margin-top:12px;">
        <table id="billTable" style="width:100%; border-collapse:collapse;">
          <thead>
            <tr>
              <th style="text-align:left; border-bottom:1px solid #e5e7eb; padding:8px;">Dịch vụ</th>
              <th style="text-align:right; border-bottom:1px solid #e5e7eb; padding:8px;">Đơn giá</th>
              <th style="text-align:center; border-bottom:1px solid #e5e7eb; padding:8px; width:120px;">SL</th>
              <th style="text-align:right; border-bottom:1px solid #e5e7eb; padding:8px;">Thành tiền</th>
              <th style="border-bottom:1px solid #e5e7eb; padding:8px; width:60px;"></th>
            </tr>
          </thead>
          <tbody id="billBody"></tbody>
          <tfoot>
            <tr>
              <td colspan="3" style="text-align:right; padding:10px 8px; font-weight:600;">Tổng cộng</td>
              <td style="text-align:right; padding:10px 8px; font-weight:700;" id="grandTotal">0₫</td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>

  <div class="footer-actions">
    <button class="btn">Hủy</button>
    <button class="btn primary" onclick="saveForm()">Lưu đăng ký KCB</button>
    <button class="btn" onclick="window.print()">In phiếu thanh toán</button>
  </div>
</section>

    <script>
    function addService() {
      const group = document.getElementById('serviceGroup').value;
      const name = document.getElementById('serviceName').value;
      const list = document.getElementById('serviceList');
      document.getElementById('emptyService').style.display = 'none';
      const item = document.createElement('div');
      item.className = 'inline';
      item.style.justifyContent = 'space-between';
      item.style.borderBottom = '1px solid #e5e7eb';
      item.style.padding = '6px 0';
      item.innerHTML = `<span>${group} - ${name}</span><button class="btn" onclick="this.parentElement.remove()">Xóa</button>`;
      list.appendChild(item);
    }
    </script>

  </main>

  <script>
    function toggleBHYT(on) {
      document.getElementById('bhyt-block').style.display = on ? 'block' : 'none';
    }
    function saveForm() {
      alert('✅ Đã lưu bản nháp (wireframe demo). Tích hợp lưu backend sau.');
    }
    function toggleChuyenTuyen(on) {
      document.getElementById('ct-block').style.display = on ? 'block' : 'none';
    }
    // Thêm sự kiện click cho nút "Danh sách tiếp nhận"
    document.addEventListener('DOMContentLoaded', function() {
      // Tìm nút theo văn bản nội dung
      const buttons = document.querySelectorAll('button');
      let listButton = null;
      for (let i = 0; i < buttons.length; i++) {
        if (buttons[i].textContent.trim() === 'Danh sách tiếp đón') {
          listButton = buttons[i];
          break;
        }
      }
      
      if (listButton) {
        listButton.addEventListener('click', function() {
          
        });
      }
    });
    // init
    toggleBHYT(true);
    toggleChuyenTuyen(false);
  </script>

  <script>
    const selectEl = document.getElementById('serviceName');
    const addBtn = document.getElementById('btnAddService');
    const bodyEl = document.getElementById('billBody');
    const grandEl = document.getElementById('grandTotal');

    function formatVND(n) {
      const num = Number(n || 0);
      return new Intl.NumberFormat('vi-VN').format(num) + '₫';
    }

    function parseNumber(str) {
      if (typeof str === 'number') return str;
      if (!str) return 0;
      return Number(String(str).replace(/[^\d.-]/g, '')) || 0;
    }

    function updateRowTotal(tr) {
      const price = parseNumber(tr.dataset.price);
      const qty = parseNumber(tr.querySelector('.qty-input').value);
      const total = price * qty;
      tr.querySelector('.cell-total').textContent = formatVND(total);
    }

    function updateGrandTotal() {
      let sum = 0;
      bodyEl.querySelectorAll('tr').forEach(tr => {
        const price = parseNumber(tr.dataset.price);
        const qty = parseNumber(tr.querySelector('.qty-input').value);
        sum += price * qty;
      });
      grandEl.textContent = formatVND(sum);
    }

    function addOrIncrement(serviceId, name, price) {
      // nếu đã có dòng, tăng SL
      const existing = bodyEl.querySelector(`tr[data-id="${serviceId}"]`);
      if (existing) {
        const qtyInput = existing.querySelector('.qty-input');
        qtyInput.value = parseNumber(qtyInput.value) + 1;
        updateRowTotal(existing);
        updateGrandTotal();
        return;
      }
      // tạo dòng mới
      const tr = document.createElement('tr');
      tr.dataset.id = serviceId;
      tr.dataset.price = String(price);

      tr.innerHTML = `
        <td style="padding:8px;">${name}</td>
        <td style="padding:8px; text-align:right;" class="cell-price">${formatVND(price)}</td>
        <td style="padding:8px; text-align:center;">
          <input class="qty-input" type="number" min="1" value="1" />
        </td>
        <td style="padding:8px; text-align:right;" class="cell-total">${formatVND(price)}</td>
        <td style="padding:8px; text-align:center;">
          <button class="btn danger btn-remove" type="button">Xoá</button>
        </td>
      `;

      // sự kiện số lượng
      tr.querySelector('.qty-input').addEventListener('input', (e) => {
        if (parseNumber(e.target.value) < 1) e.target.value = 1;
        updateRowTotal(tr);
        updateGrandTotal();
      });

      // sự kiện xoá dòng
      tr.querySelector('.btn-remove').addEventListener('click', () => {
        tr.remove();
        updateGrandTotal();
      });

      bodyEl.appendChild(tr);
      updateGrandTotal();
    }

    function addSelectedService() {
      const opt = selectEl.selectedOptions[0];
      if (!opt) return;
      const id = opt.value || opt.textContent.trim();
      const name = opt.textContent.trim();
      const price = parseNumber(opt.getAttribute('data-price'));
      addOrIncrement(id, name, price);
    }

    // Thêm bằng nút
    addBtn.addEventListener('click', addSelectedService);

    // Nhấn Enter trên select để thêm nhanh
    selectEl.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        addSelectedService();
      }
    });

    // Tự thêm dịch vụ đầu tiên khi tải (tuỳ chọn: bỏ nếu không muốn)
    // addSelectedService();
  </script>
<!-- QR Code Scan Popup -->
  <div id="qrCodeScanPopup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 800px; height: 90%; background: white; border-radius: 8px; overflow: hidden;">
      <!-- Popup Header -->
      <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; border-bottom: 1px solid #ddd;">
        <h3 style="margin: 0;">Quét Mã QR trên CCCD</h3>
        <button onclick="closeQRCodeScanPopup()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
      </div>
      
      <!-- Camera Scan Area -->
      <div id="cameraScanArea" style="height: calc(100% - 60px); display: flex; flex-direction: row;">
        <!-- Left side: Camera view -->
        <div style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px;">
          <div id="startCameraScan">
            <p style="text-align: center; margin-bottom: 20px;">Nhấn nút dưới đây để bắt đầu quét mã QR trên CCCD</p>
            <button onclick="startCameraScan()" style="padding: 10px 20px; background-color: #4299E1; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px;">
              Bật Camera
            </button>
          </div>
          <video id="video" autoplay playsinline style="max-width: 100%; max-height: 70vh; display: none;"></video>
          <canvas id="canvas" style="display: none;"></canvas>
          <div id="scanningStatus" style="margin-top: 20px; text-align: center; display: none;">
            <p style="color: #4CAF50; font-size: 18px;">Đang quét mã QR...</p>
            <p style="font-size: 14px; color: #666;">Hãy đưa CCCD vào vùng quét</p>
          </div>
        </div>
        
        <!-- Right side: Instructions -->
        <div style="width: 300px; background-color: #f5f5f5; padding: 20px; overflow-y: auto;">
          <h4 style="margin-top: 0;">Hướng dẫn sử dụng</h4>
          <ul style="padding-left: 20px;">
            <li>Nhấn "Bật Camera" để bắt đầu</li>
            <li>Cho phép truy cập camera khi được hỏi</li>
            <li>Đưa CCCD vào vùng quét, đảm bảo mã QR đầy đủ</li>
            <li>Không cần chụp ảnh, hệ thống sẽ tự động quét</li>
            <li>Sau khi quét thành công, thông tin sẽ được điền tự động</li>
          </ul>
          <div style="margin-top: 30px;">
            <h4>Lưu ý</h4>
            <ul style="padding-left: 20px;">
              <li>Đảm bảo khu vực quét được đầy đủ ánh sáng</li>
              <li>Tránh rung tay khi quét</li>
              <li>Nếu không quét được, vui lòng nhập thủ công</li>
            </ul>
          </div>
          <button onclick="stopCameraScan()" style="margin-top: 30px; padding: 8px 16px; background-color: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer; width: 100%;">
            Dừng Camera
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // QR Code Scan Functions
    function openQRCodeScanPopup() {
      document.getElementById('qrCodeScanPopup').style.display = 'block';
    }
    
    function closeQRCodeScanPopup() {
      document.getElementById('qrCodeScanPopup').style.display = 'none';
      stopCameraScan();
    }
    
    let stream = null;
    let scanningInterval = null;
    
    function startCameraScan() {
      const video = document.getElementById('video');
      const canvas = document.getElementById('canvas');
      const startScreen = document.getElementById('startCameraScan');
      const scanningStatus = document.getElementById('scanningStatus');
      
      startScreen.style.display = 'none';
      video.style.display = 'block';
      scanningStatus.style.display = 'block';
      
      // Request camera access
      navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
        .then(function(mediaStream) {
          stream = mediaStream;
          video.srcObject = stream;
          
          // Start scanning process
          scanningInterval = setInterval(() => {
            scanQRCodeFromVideo(video, canvas);
          }, 1000);
        })
        .catch(function(err) {
          console.error('Lỗi khi truy cập camera: ', err);
          alert('Không thể truy cập camera. Vui lòng kiểm tra quyền truy cập.');
          stopCameraScan();
        });
    }
    
    function stopCameraScan() {
      const video = document.getElementById('video');
      const canvas = document.getElementById('canvas');
      const startScreen = document.getElementById('startCameraScan');
      const scanningStatus = document.getElementById('scanningStatus');
      
      if (stream) {
        stream.getTracks().forEach(track => track.stop());
        stream = null;
      }
      
      if (scanningInterval) {
        clearInterval(scanningInterval);
        scanningInterval = null;
      }
      
      video.style.display = 'none';
      canvas.style.display = 'none';
      startScreen.style.display = 'block';
      scanningStatus.style.display = 'none';
    }
    
    function scanQRCodeFromVideo(video, canvas) {
      const ctx = canvas.getContext('2d');
      
      // Set canvas dimensions to match video
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      
      // Draw current video frame to canvas
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      
      // Get image data from canvas
      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      
      // In a real implementation, you would use a QR code scanning library here
      // For this example, we'll simulate a successful scan after 5 seconds
      // In production, you should integrate with a library like jsQR, qrcode.js, or zxing-js
      
      // Simulated scan result (in real app, replace with actual QR code scanning logic)
      simulateScanResult();
    }
    
    function simulateScanResult() {
      // This is just a simulation - in a real app, you would parse the actual QR code data
      // and extract the citizen ID information
      const mockData = {
        fullName: 'NGUYỄN VĂN A',
        dateOfBirth: '01/01/1990',
        gender: 'Nam',
        idNumber: '0123456789',
        address: '123 Đường ABC, Quận 1, TP.HCM'
      };
      
      // Fill the form with the scanned data
      document.getElementById('fullName').value = mockData.fullName;
      
      // Show success message
      alert('Quét thành công! Thông tin đã được điền vào biểu mẫu.');
      
      // Close the popup
      closeQRCodeScanPopup();
    }
    
    // Popup danh sách bệnh nhân đã tiếp nhận
    function openPatientListPopup() {
      console.log('正在打开弹出窗口');
      const popup = document.getElementById('patientListPopup');
      if (popup) {
        console.log('找到弹出窗口元素');
        popup.style.display = 'flex';
        loadPatientList();
      } else {
        console.log('未找到弹出窗口元素');
      }
    }
    
    function closePatientListPopup() {
      document.getElementById('patientListPopup').style.display = 'none';
    }
    
    function loadPatientList() {
      // Dữ liệu mẫu bệnh nhân
      const patientData = [
        { id: 'BN001', name: 'NGUYỄN VĂN A', dob: '01/01/1990', gender: 'Nam', time: '2024-01-15 08:30', type: 'BHYT', status: 'Chờ Thanh Toán' },
        { id: 'BN002', name: 'TRẦN THỊ B', dob: '02/02/1985', gender: 'Nữ', time: '2024-01-15 09:15', type: 'Dịch vụ', status: 'Huỷ' },
        { id: 'BN003', name: 'LÊ VĂN C', dob: '03/03/2000', gender: 'Nam', time: '2024-01-15 10:00', type: 'Cấp cứu', status: 'Đã thanh toán' },
        { id: 'BN004', name: 'PHẠM THỊ D', dob: '04/04/1975', gender: 'Nữ', time: '2024-01-15 10:45', type: 'Tái khám', status: 'Danh khám' },
        { id: 'BN005', name: 'HOÀNG VĂN E', dob: '05/05/1995', gender: 'Nam', time: '2024-01-15 11:30', type: 'BHYT', status: 'Hoàn tất' }
      ];
      
      const tableBody = document.getElementById('patientListBody');
      tableBody.innerHTML = '';
      
      patientData.forEach(patient => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td style="padding: 12px; border: 1px solid #ddd;">${patient.id}</td>
          <td style="padding: 12px; border: 1px solid #ddd;">${patient.name}</td>
          <td style="padding: 12px; border: 1px solid #ddd;">${patient.dob}</td>
          <td style="padding: 12px; border: 1px solid #ddd;">${patient.gender}</td>
          <td style="padding: 12px; border: 1px solid #ddd;">${patient.time}</td>
          <td style="padding: 12px; border: 1px solid #ddd;">${patient.type}</td>
          <td style="padding: 12px; border: 1px solid #ddd;">
            <span style="background-color: #4CAF50; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px;">${patient.status}</span>
          </td>
          <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">
            <button class="btn secondary" style="padding: 4px 8px; font-size: 12px;">Xem chi tiết</button>
            <button class="btn primary" style="padding: 4px 8px; font-size: 12px; margin-left: 5px;">In phiếu</button>
            <button class="btn thirty" style="padding: 4px 8px; font-size: 12px;">Huỷ tiếp đón</button>
          </td>
        `;
        tableBody.appendChild(row);
      });
    }
    
    // Thêm sự kiện click cho nút "Danh sách tiếp nhận"
    document.addEventListener('DOMContentLoaded', function() {
      // 直接为按钮添加ID来简化查找
      const buttons = document.querySelectorAll('button');
      let found = false;
      
      for (let i = 0; i < buttons.length; i++) {
        if (buttons[i].textContent.trim() === 'Danh sách tiếp đón') {
          // 为了确保可维护性，为按钮添加ID
          buttons[i].id = 'patientListButton';
          found = true;
          break;
        }
      }
      
      // 使用ID来绑定事件，这样更可靠
      const listButton = document.getElementById('patientListButton');
      if (listButton) {
        listButton.addEventListener('click', function() {
          console.log('点击了"Danh sách tiếp nhận"按钮');
          openPatientListPopup();
        });
        console.log('已成功绑定按钮点击事件');
      } else if (!found) {
        console.log('未找到文本为"Danh sách tiếp nhận"的按钮');
      }
      
      // Thêm sự kiện click cho nút đóng
      const closeButton = document.getElementById('closePatientListPopup');
      if (closeButton) {
        closeButton.addEventListener('click', closePatientListPopup);
      }
      
      // Thêm sự kiện click ra ngoài popup để đóng
      const popup = document.getElementById('patientListPopup');
      if (popup) {
        popup.addEventListener('click', function(event) {
          if (event.target === popup) {
            closePatientListPopup();
          }
        });
      }
    });
  </script>
  
  <!-- Popup danh sách bệnh nhân đã tiếp nhận -->
  <div id="patientListPopup" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1000; align-items: center; justify-content: center;">
    <div style="background-color: white; border-radius: 8px; width: 90%; height: 90%; overflow-y: auto; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
      <div style="padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">
        <h3>Danh sách bệnh nhân đã tiếp đón</h3>
        <button id="closePatientListPopup" class="btn danger" style="padding: 6px 12px;">Đóng</button>
      </div>
      <div style="padding: 20px;">
        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
          <input type="text" id="patientListSearch" placeholder="Tìm kiếm bệnh nhân" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px; min-width: 800px;">
          <select id="patientListFilter" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            <option value="all">Tất cả</option>
            <option value="today">Hôm nay</option>
            <option value="week">Tuần nay</option>
            <option value="month">Tháng nay</option>
          </select>
        </div>
        <table style="width: 100%; border-collapse: collapse;">
          <thead>
            <tr style="background-color: #f5f5f5;">
              <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">Mã bệnh nhân</th>
              <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">Họ tên</th>
              <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">Ngày sinh</th>
              <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">Giới tính</th>
              <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">Thời gian tiếp đón</th>
              <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">Loại tiếp đón</th>
              <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">Trạng thái</th>
              <th style="padding: 12px; border: 1px solid #ddd; text-align: center;">Thao tác</th>
            </tr>
          </thead>
          <tbody id="patientListBody">
            <!-- Dữ liệu bệnh nhân sẽ được hiển thị ở đây -->
          </tbody>
        </table>
      </div>
    </div>
  </div>
</body>
</html>